<div class="full-width">
  <h3>Manage Track: {{track.name}}</h3>

  <form [formGroup]="tracksForm">
    <mat-form-field class="full-width">
      <mat-label>Track ID*</mat-label>
      <input matInput formControlName="trackId" />
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Name*</mat-label>
      <input matInput formControlName="name" [errorStateMatcher]="matcher"/>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Code*</mat-label>
      <input matInput formControlName="code" [errorStateMatcher]="matcher"/>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Icon*</mat-label>
      <mat-select formControlName="icon">
        @for (icon of icons$ | async; track icon.path) {
          <mat-option [value]="icon.path">{{ icon.name }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <app-manage-restrictions 
      [contentId]="track.trackId" 
      contentType='Track' 
      [contentName]='track.name'
      (currentRestrictions)="restrictions=$event"
      contentIdString="trackId"
      >
    </app-manage-restrictions>

    <div class="contentPickerTitle" *ngIf="addedCourses && addedCourses.length">
      <span>Courses making up the Track:</span>
      <div class="course-table mat-elevation-z8">
        <table mat-table class="content-table" [dataSource]="courseDataSource">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Course </th>
            <td mat-cell *matCellDef="let course"> {{ course.name }} </td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let course"> 
              <button mat-stroked-button color="error" (click)="deleteCourse(course.courseId)" type="button">Delete</button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedCourseColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedCourseColumns;"></tr>
        </table>
      </div>
    </div>

    <div class="full-width addContentBlock">
      <mat-form-field class="addCourse">
        <mat-label>Add courses</mat-label>
        <mat-select formControlName="courses">
          <mat-option [value]="course" *ngFor="let course of courses$">{{ course.name }}</mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-raised-button color="primary" class="addButton" (click)="addCourse()" type="button">Add</button>
    </div>
    
    <div class="buttons">
      <button mat-raised-button color="primary" type="button" (click)="updateTrack()">Save</button>
      <button mat-raised-button color="warn" type="button" (click)="onCancel.emit()">Cancel</button>
    </div>
  </form>
</div>