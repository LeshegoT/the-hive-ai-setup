<div class="full-width">
  <h3>Create New Side Quest</h3>

  <form [formGroup]="sideQuestForm" #parentForm="ngForm" (ngSubmit)="createQuest()">
    <mat-form-field class="full-width">
      <mat-label>Type*</mat-label>
      <mat-select formControlName="type">
        <mat-option [value]="type.code" *ngFor="let type of typeSubscription$ | async">{{ type.name }}</mat-option>
      </mat-select>
      <mat-hint align="end">Create new types by selecting Side Quest Type above</mat-hint>
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Name*</mat-label>
      <input matInput formControlName="name" [errorStateMatcher]="matcher" />
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Link</mat-label>
      <input matInput formControlName="link" [errorStateMatcher]="matcher" />
    </mat-form-field>

    <mat-form-field class="full-width">
      <mat-label>Venue*</mat-label>
      <input matInput formControlName="venue" [errorStateMatcher]="matcher" />
    </mat-form-field>

    <app-date-time-picker formControlName="startDate" label="Start"></app-date-time-picker>

    <mat-checkbox class="padded" formControlName="external">External event</mat-checkbox>

    <mat-checkbox class="padded" formControlName="registrationRequired">Registration required</mat-checkbox>

    <div class="contentPickerTitle" *ngIf="addedGroups && addedGroups.length">
      <span>Content will be restricted to the following groups:</span>
      <table mat-table class="full-width content-table mat-elevation-z8" [dataSource]="groupDataSource">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Group </th>
          <td mat-cell *matCellDef="let group"> {{ group.groupName }} </td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef> Action </th>
          <td mat-cell *matCellDef="let group"> 
            <button mat-stroked-button color="error" (click)="deleteGroup(group.groupName)" type="button">Delete</button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedGroupColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedGroupColumns;"></tr>
      </table>
    </div>

    <div class="full-width addContentBlock">
      <mat-form-field class="addGroup">
        <mat-label>Restrict content to group</mat-label>
        <mat-select formControlName="restrictGroup">
          <mat-option [value]="group" *ngFor="let group of groups$ | async">{{ group.groupName }}</mat-option>
        </mat-select>
        <mat-hint align="end">Create new groups by selecting Group above</mat-hint>
      </mat-form-field>
      <button mat-raised-button color="primary" class="addButton" (click)="addGroup()" type="button">Add</button>
    </div>

    <mat-form-field class="full-width">
      <mat-label>Description*</mat-label>
      <textarea matInput formControlName="description" [errorStateMatcher]="matcher" ></textarea>
      <mat-hint align="end">Markdown supported</mat-hint>
    </mat-form-field>

    <div class="error" *ngIf="error">
      Please ensure all required fields are filled in and that there are no errors above.
    </div>

    <div class="buttons">
      <button mat-raised-button color="primary" type="submit">Save</button>
    </div>
  </form>
</div>

