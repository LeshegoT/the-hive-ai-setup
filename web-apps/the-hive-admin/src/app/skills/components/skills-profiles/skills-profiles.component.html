<main class="profiles-section">
  @let skillsProfiles = skillsProfiles$ | async;
  @let isLoggedInUserMemberOfModifyBioInformationUsers = isLoggedInUserMemberOfModifyBioInformationUsers$ | async;
  <div class="profiles-layout">
    <section class="profiles-list" [class.hidden]="showForm">
      @if(skillsProfiles) {
        @if(skillsProfiles.length > 0) {
          <table mat-table [dataSource]="skillsProfiles" class="mat-elevation-z8">
            <ng-container *ngFor="let column of tableColumns; let isLast = last" [matColumnDef]="column.columnName">
              <th mat-header-cell *matHeaderCellDef>{{ column.headerName }}</th>
              <td mat-cell *matCellDef="let skillsProfile">
                {{ skillsProfile[column.columnName] }}
              </td>
              <td mat-footer-cell *matFooterCellDef [class.last-column]="isLast">
                @if(isLast) {
                  <button mat-stroked-button color="primary" (click)="addNewProfile()" class="add-profile-button">
                    <mat-icon>add</mat-icon>Add profile
                  </button>
                } @else {
                  <!-- is not the last column  don't display the add profile button-->
                }
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="columnNames"></tr>
            @if(isLoggedInUserMemberOfModifyBioInformationUsers) {
              <tr
                class="selectable-row"
                mat-row
                *matRowDef="let row; columns: columnNames"
                [class.selected]="selectedRow === row"
                (click)="selectRow(row)">
              </tr>
            } @else {
              <tr mat-row *matRowDef="let row; columns: columnNames"></tr>
            }
            @if(isLoggedInUserMemberOfModifyBioInformationUsers) {
              <tr mat-footer-row *matFooterRowDef="columnNames"></tr>
            } @else {
              <!-- the user is not a member of the modify bio information users group so don't display the footer row-->
            }
            <tr *matNoDataRow><td class="mat-cell" [attr.colspan]="columnNames.length">Staff has no profiles</td></tr>
          </table>
        } @else {
          <div class="empty-state">
            <h3>Staff has no profiles</h3>
            @if(isLoggedInUserMemberOfModifyBioInformationUsers) {
              <button mat-raised-button color="primary" (click)="addNewProfile()">
                <mat-icon>add</mat-icon>
                Create profile
              </button>
            } @else {
              <!-- the user is not a member of the modify bio information users group so don't display the create profile button-->
            }
          </div>
        }
      } @else {
        <div class="spinner-container">
          <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
        </div>
      }
    </section>

    @if(showForm) {
      <aside class="form-panel">
        <header class="form-header">
          <h2>{{ selectedRow ? 'Edit profile' : 'Add new profile' }}</h2>
          <button type="button" mat-icon-button (click)="closeForm()">
            <mat-icon>close</mat-icon>
          </button>
        </header>

        <form [formGroup]="skillsProfilesForm" #formGroupDirective="ngForm" class="form-content">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Description</mat-label>
            <input matInput formControlName="shortDescription" placeholder="Write a short desrcription about your profile">
            @if(shortDescription.hasError('required')) {
              <mat-error>Profile is required</mat-error>
            } @else if(shortDescription.hasError('minlength')) {
              <mat-error>Must be at least {{ minimumInputText }} characters</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Profile</mat-label>
            <textarea matInput formControlName="skillsProfile" placeholder="Enter your profile here" rows="5"></textarea>
            @if(skillsProfile.hasError('required')) {
              <mat-error>Profile is required</mat-error>
            } @else if(skillsProfile.hasError('minlength')) {
              <mat-error>Must be at least {{ minimumInputText }} characters</mat-error>
            }@else {
                <!-- Profile is required -->
                }

          </mat-form-field>
        </form>

        <div class="form-actions">
          <button mat-button (click)="revertChanges()">
            <mat-icon>undo</mat-icon>
            Revert
          </button>
          <button mat-raised-button color="primary" (click)="saveChanges()" [disabled]="saveChanges$">
            @if (saveChanges$) {
              <mat-progress-spinner class="button-spinner" mode="indeterminate" diameter="16">
                    </mat-progress-spinner>
            } @else {
              <mat-icon>save</mat-icon>
            }
            Save
          </button>
        </div>
      </aside>
    } @else{
      <!-- Form Panel is hidden -->
    }
  </div>
</main>
